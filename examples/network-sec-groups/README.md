# Deploy Network Security Groups with Terraform for a PowerScale Cluster in Azure

A Terraform configuration file, `main.tf`, has been provided in this directory as an example module to deploy the internal and external security groups for a PowerScale cluster. This example will also automatically create a resource group to contain the security groups.

## Description

For the complete set of input variables that can be provided, check the `variables.tf` file.

For the minimal set of input parameters that needs to be passed to this Terraform module, create the `terraform.tfvars` file and provide the following required input variables in that file:

```json
{
    subscription_id = <#######-####-####-####-############>
    cluster_name = <cluster_name>   # in this example, this variable is optional
}
```

If a `cluster_name` is not specified in the `terraform.tfvars` file, a `cluster_name` will automatically be generated and used.

## Deploy Terraform Module

Download the terraform provider and configure the module using:

```shell
terraform init
```

To apply the changes run:

```shell
terraform apply -auto-approve
```

To get the output parameters generated by the module:

```shell
terraform output
```

<details>
<summary>Click to expand sample response</summary>

Response:

```textmate
cluster_name = "assured-peacock"
external_nsg = "oa4ay196-assured-peacock-external-nsg"
internal_nsg = "oa4ay196-assured-peacock-internal-nsg"
resource_group_name = "oa4ay196-assured-peacock-rg"
```

</details>